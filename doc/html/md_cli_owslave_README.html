<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>sketchbook: MoaT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">sketchbook
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MoaT </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>or "Master of all Things" is a project to control various interesting little things using 1wire, via a common interface.</p>
<p>The master copy of this code is located at <a href="https://github.com/M-o-a-T/owslave">https://github.com/M-o-a-T/owslave</a> &ndash; please come and contribute! (Bug reports welcome.)</p>
<h2>Goals</h2>
<p>1wire is a nice protocol for wire-based home automation. It's reasonably fast, stock hardware like basic I/O or temperature sensors are dirt cheap, and you can attach tiny AVR controllers (think Arduino) without any additional hardware.</p>
<p>It also has drawbacks. There's only one master, so you need to poll. The available I/O solutions are limited. Most slaves can't be parameterized in any meaningful way, can't work autonomously if the bus is wedged, and don't use CONDITIONAL SEARCH (required for any non-trivial network).</p>
<p>MoaT slaves are different. A common configuration file lists the features for each device you program. The parameters are added to the flash code (or, in the hopefully-not-too-far future, to the device's EEPROM) and can be interrogated via 1wire. OWFS then exports exactly those featurs which your device actually uses.</p>
<h2>License</h2>
<p>This is 1wire slave code for AVR microcontrollers. Copyright (C) 2010-2015 Matthias Urlichs <a href="#" onclick="location.href='mai'+'lto:'+'mat'+'th'+'ias'+'@u'+'rli'+'ch'+'s.d'+'e'; return false;">matth<span style="display: none;">.nosp@m.</span>ias@<span style="display: none;">.nosp@m.</span>urlic<span style="display: none;">.nosp@m.</span>hs.d<span style="display: none;">.nosp@m.</span>e</a>.</p>
<pre class="fragment">This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</pre><h2>Implementation</h2>
<p>The core code implements the basic 1wire discovery methods, including single-device mode and conditional discovery. Basic Code for e.g. the DS2423 fits in 2k on an ATtiny. Barely, but it fits. ;-)</p>
<p>Overdrive speed is not implemented, and probably never will be, because the timing constraints are too tight.</p>
<p>You can enable a debug pin which is a great help if you have timing problems; just add a 2-channel oscilloscope.</p>
<p>The 64-bit ID is optionally read from EEPROM. A tool to generate the 8-bit CRC is included.</p>
<p>The 1wire bus must be connected to the INT0 pin. See <code><a class="el" href="features_8h.html">features.h</a></code> or your microcontroller's data sheet which hardware pin that is. For example, on an ATmega168 it's PD2 (pin 4 if your ATmega lives in a 28-pin PDIP package). Add a power supply (leeching parasite power from the bus is not a good idea) and a capacitor, and your 1wire slave is ready to go (of course, you do need to program it).</p>
<h3>History</h3>
<p>Originally, this project consisted of an effort to convert convoluted code from the net, history unknown but apparently licensed GPL2, to something equally convoluted but more generic. And large. The work then languished for a couple of years.</p>
<p>At the beginning of 2015, Matthias Urlichs used code from Tobias Mueller <a href="#" onclick="location.href='mai'+'lto:'+'mai'+'l@'+'tob'+'yn'+'et.'+'de'; return false;">mail@<span style="display: none;">.nosp@m.</span>toby<span style="display: none;">.nosp@m.</span>net.d<span style="display: none;">.nosp@m.</span>e</a> to shrink down and rewrite the whole thing.</p>
<p>The Makefile was trimmed, build and device configuration was moved to a separate config file, and the project goal became a whole lot more ambitious.</p>
<h3>1wire slaves</h3>
<p>It appears that Dallas Semiconductor doesn't like people who implement 1wire slaves in software.</p>
<p>On the other hand, they do discontinue ICs like the DS2423 counter for which no known substitute exists.</p>
<p>Therefore, code to emulate specific 1wire slave ICs will only be added to this project's repository if the ICs are no longer available or "not
recommended for new design".</p>
<p>Of course, code that does things which doesn't have a silicon equivalent is always welcome.</p>
<h3>OWFS</h3>
<p>A nice and shiny 1wire client does not help if there's no server. Therefore, if you add your own code, please also submit appropriate changes to the owfs project so that other people can actually talk to your stuff.</p>
<p>The OWFS code for MoaT devices is located at <a href="#" onclick="location.href='mai'+'lto:'+'git'+'@g'+'ith'+'ub'+'.co'+'m'; return false;">git@g<span style="display: none;">.nosp@m.</span>ithu<span style="display: none;">.nosp@m.</span>b.com</a>:M-o-a-T/owfs.git .</p>
<p>NB: OWFS supports conditional search even if the "alarm" directory is missing. You can still access it.</p>
<h2>HOWTO</h2>
<p>For build instructions, see <a class="el" href="HOWTO_8md.html">HOWTO.md</a></p>
<h3>Rationale</h3>
<p>This project uses its own build system, based on a configuration file and <code>make</code>.</p>
<p>The reason is simple enough: suppose you want to prepare or update 100 devices for installation in a new house.</p>
<p>You do <em>not</em> want to click your way through a GUI to do this.</p>
<p>The first time through, you want to issue one command and then plug each device into the programmer. Wait, unplug, repeat.</p>
<p>After it's all installed, you want to run "make update-all" and have the build system handle everything. Yes, this includes firmware uploads via 1wire.</p>
<p>MoaT doesn't yet support online firmware updates. But it will.</p>
<h2>TODO</h2>
<h3>bugs</h3>
<ul>
<li>make sure that an idle 1wire never results in a hung device</li>
</ul>
<h3>optimizations</h3>
<ul>
<li>interrupt-based port monitoring</li>
<li>hardware-based PWM</li>
</ul>
<h3>implementations</h3>
<ul>
<li>secondary 1wire bus?</li>
<li>I²C bus?</li>
<li>RF12/RF69?</li>
<li>more over-the-wire config changes</li>
<li>over-the-wire firmware update</li>
<li>some (esp. 1wire) statistics</li>
<li>PID</li>
<li>SMOKE</li>
<li>I2C interface</li>
<li>THERMO via I2C</li>
<li>HYGRO via I2C</li>
<li>serial bridge</li>
<li>named ports </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 24 2019 21:30:39 for sketchbook by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
