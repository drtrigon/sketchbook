<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>sketchbook: _howto_build-burn_ds2423</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">sketchbook
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">_howto_build-burn_ds2423 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>( osboxes:~/sketchbook/cli/owslave$ sudo apt-get install gcc-avr_4.5.3 )</p>
<p>&mdash; using ATtiny84 (attiny84) &mdash;</p>
<p>-&mdash; programmer -&mdash;</p>
<p>Use Arduino Uno and my "Programmer Shield".</p>
<p>Open Arduino IDE (e.g. 1.6.5) and open File &gt; Examples &gt; ArdinoISP</p>
<p>Upload the sketch to an Arduino Uno board.</p>
<p>Adopt "Programmer Shield" to be wired for a tiny84, see sketch and: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/8006S.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/8006S.pdf</a> <a href="http://www.3bm.de/2013/09/17/attiny84-mit-arduino-uno-programmieren/">http://www.3bm.de/2013/09/17/attiny84-mit-arduino-uno-programmieren/</a></p>
<ul>
<li>Arduino 5V an ATtiny84 Pin 1 (VCC +)</li>
<li>Arduino GND an ATTiny84 Pin 14 (GND -)</li>
<li>Arduino Pin 10 an ATtiny84 Pin 4 (Reset)</li>
<li>Arduino Pin 11 an ATTiny84 Pin 7 (Pin 6, PWM, Analog Input 7)</li>
<li>Arduino Pin 12 an ATTiny84 Pin 8 (Pin 5, Analog Input 5, PWM, MISO)</li>
<li>Arduino Pin 13 an ATTiny84 Pin 9 (Pin 4, Analog Input 4, SCK)</li>
</ul>
<p>-&mdash; chip -&mdash;</p>
<p>create or add you project.cfg (project.cfg.tiny84) to the folder</p>
<p>osboxes:~/sketchbook/cli/owslave$ nano Makefile</p>
<p>change the line  -c  -p  -C +$$TF\ into  -c  -p t84 -b 19200 -P /dev/ttyACM0 -C +$$TF\ save and quit</p>
<p>osboxes:~/sketchbook/cli/owslave$ chmod +x cfg <a class="el" href="Cfg_8py.html">Cfg.py</a> cfg_write gen_eeprom <a class="el" href="ordered__yaml_8py.html">ordered_yaml.py</a></p>
<p>osboxes:~/sketchbook/cli/owslave$ make CFG=project.cfg try1 make[1]: Entering directory `/home/osboxes/sketchbook/cli/owslave' mkdir -p device/try1 MCU:atmega88 MCU_PROG:m88 PROG:avrisp AVRDUDE:sudo avrdude CFILES:<a class="el" href="moat__backend_8c.html">moat_backend.c</a> main.c jmp.S <a class="el" href="dev__data_8c.html">dev_data.c</a> config.o <a class="el" href="timer_8c.html">timer.c</a> <a class="el" href="ds2423_8c.html">ds2423.c</a> <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="crc_8c.html">crc.c</a> TYPE:alert -1 count 0 config -1 port 0 humid 0 pid 0 temp 0 console 0 smoke 0 pwm 0 adc 0 mkdir -p device/try1 ./cfg project.cfg .hdr try1 avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/moat_backend.o <a class="el" href="moat__backend_8c.html">moat_backend.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/main.o main.c main.c:120:17: warning: ‘bootseq’ defined but not used [-Wunused-variable] static uint16_t bootseq <b>attribute</b>((section(".noinit"))); ^ avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/jmp.o jmp.S avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/dev_data.o <a class="el" href="dev__data_8c.html">dev_data.c</a> set -e; \ ./gen_eeprom device/try1/eprom.bin type $(./cfg project.cfg .type try1); \ if ./gen_eeprom device/try1/eprom.bin name &gt;/dev/null 2&gt;&amp;1 ; then : ; else \ ./gen_eeprom device/try1/eprom.bin name try1 ; fi ; \ if [ ds2423 != 0 ] ; then \ if ./gen_eeprom device/try1/eprom.bin owid serial &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./gen_eeprom device/try1/eprom.bin owid serial); \ if ./cfg project.cfg devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ test "$(./cfg project.cfg devices.try1.onewire_id)" = "$SER" ; \ else \ ./cfg_write project.cfg devices.try1.onewire_id x$SER; \ fi; \ elif ./cfg project.cfg .nofollow devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./cfg project.cfg devices.try1.onewire_id); \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial $SER; \ else \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial random; \ ./cfg_write project.cfg devices.try1.onewire_id x$(./gen_eeprom device/try1/eprom.bin owid serial); \ fi; \ fi avr-objcopy -I binary -O elf32-avr &ndash;prefix-sections=.eeprom \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_start=_econfig_start" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_size=_econfig_size" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_end=_econfig_end" \ device/try1/eprom.bin device/try1/config.o avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/timer.o <a class="el" href="timer_8c.html">timer.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/ds2423.o <a class="el" href="ds2423_8c.html">ds2423.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/onewire.o <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="onewire_8c.html">onewire.c</a>:553:2: warning: #warning "Ignore the 'appears to be a misspelled signal handler' warning" [-Wcpp] #warning "Ignore the 'appears to be a misspelled signal handler' warning" ^ <a class="el" href="onewire_8c.html">onewire.c</a>: In function ‘real_PIN_INT’: <a class="el" href="onewire_8c.html">onewire.c</a>:554:6: warning: ‘real_PIN_INT’ appears to be a misspelled signal handler [enabled by default] void <a class="el" href="onewire_8c.html#ad685ebd23c8e96348e9924394dc696a8">real_PIN_INT(void)</a> { ^ avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/crc.o <a class="el" href="crc_8c.html">crc.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -o device/try1/image.elf -Wl,-Map,device/try1/image.map,&ndash;cref device/try1/moat_backend.o device/try1/main.o device/try1/jmp.o device/try1/dev_data.o device/try1/config.o device/try1/timer.o device/try1/ds2423.o device/try1/onewire.o device/try1/crc.o avr-objcopy -R .eeprom -O ihex device/try1/image.elf device/try1/image.hex avr-objcopy -j .eeprom &ndash;change-section-address .eeprom=0 -O ihex device/try1/image.elf device/try1/eprom.hex avr-objdump -h -S device/try1/image.elf &gt; device/try1/image.lss make[1]: Leaving directory `/home/osboxes/sketchbook/cli/owslave'</p>
<p>Press RESET button on "Programmer Shield".</p>
<p>Insert tiny84 into "Programmer Shield" socket (connect ISP).</p>
<p>Press RESET button on "Programmer Shield". LED (Pin 8) should be off.</p>
<p>osboxes:~/sketchbook/cli/owslave$ make CFG=project.cfg burn_try1 BURN try1 make[1]: Entering directory `/home/osboxes/sketchbook/cli/owslave' LFUSE:E2 HFUSE:DC EFUSE:00 EEPROM:1 MCU:atmega88 MCU_PROG:m88 PROG:avrisp AVRDUDE:sudo avrdude CFILES:<a class="el" href="moat__backend_8c.html">moat_backend.c</a> main.c jmp.S <a class="el" href="dev__data_8c.html">dev_data.c</a> config.o <a class="el" href="timer_8c.html">timer.c</a> <a class="el" href="ds2423_8c.html">ds2423.c</a> <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="crc_8c.html">crc.c</a> TYPE:alert -1 humid 0 temp 0 pid 0 smoke 0 adc 0 port 0 config -1 pwm 0 console 0 count 0 set -e; \ ./gen_eeprom device/try1/eprom.bin type $(./cfg project.cfg .type try1); \ if ./gen_eeprom device/try1/eprom.bin name &gt;/dev/null 2&gt;&amp;1 ; then : ; else \ ./gen_eeprom device/try1/eprom.bin name try1 ; fi ; \ if [ ds2423 != 0 ] ; then \ if ./gen_eeprom device/try1/eprom.bin owid serial &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./gen_eeprom device/try1/eprom.bin owid serial); \ if ./cfg project.cfg devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ test "$(./cfg project.cfg devices.try1.onewire_id)" = "$SER" ; \ else \ ./cfg_write project.cfg devices.try1.onewire_id x$SER; \ fi; \ elif ./cfg project.cfg .nofollow devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./cfg project.cfg devices.try1.onewire_id); \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial $SER; \ else \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial random; \ ./cfg_write project.cfg devices.try1.onewire_id x$(./gen_eeprom device/try1/eprom.bin owid serial); \ fi; \ fi avr-objcopy -I binary -O elf32-avr &ndash;prefix-sections=.eeprom \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_start=_econfig_start" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_size=_econfig_size" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_end=_econfig_end" \ device/try1/eprom.bin device/try1/config.o avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -o device/try1/image.elf -Wl,-Map,device/try1/image.map,&ndash;cref device/try1/moat_backend.o device/try1/main.o device/try1/jmp.o device/try1/dev_data.o device/try1/config.o device/try1/timer.o device/try1/ds2423.o device/try1/onewire.o device/try1/crc.o avr-objcopy -R .eeprom -O ihex device/try1/image.elf device/try1/image.hex avr-objcopy -j .eeprom &ndash;change-section-address .eeprom=0 -O ihex device/try1/image.elf device/try1/eprom.hex avr-objdump -h -S device/try1/image.elf &gt; device/try1/image.lss TF=$(mktemp avrdude-cfg.XXXXX); echo "default_safemode = no;" &gt;$TF; \ EFUSE=00; \ [ "" != "" ] &amp;&amp; SET_EFUSE="-U efuse:w:0x00:m"; \ sudo avrdude -c avrisp -p t84 -b 19200 -P /dev/ttyACM0 -C +$TF\ -U flash:w:device/try1/image.hex:i -U eeprom:w:device/try1/eprom.hex:i \ -U lfuse:w:0xE2:m \ -U hfuse:w:0xDC:m \ \ ; X=$?; rm $TF; exit $X</p>
<p>avrdude: AVR device initialized and ready to accept instructions</p>
<p>Reading | ################################################## | 100% 0.05s</p>
<p>avrdude: Device signature = 0x1e930c avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed To disable this feature, specify the -D option. avrdude: erasing chip avrdude: reading input file "device/try1/image.hex" avrdude: writing flash (3338 bytes):</p>
<p>Writing | ################################################## | 100% 5.65s</p>
<p>avrdude: 3338 bytes of flash written avrdude: verifying flash memory against device/try1/image.hex: avrdude: load data flash data from input file device/try1/image.hex: avrdude: input file device/try1/image.hex contains 3338 bytes avrdude: reading on-chip flash data:</p>
<p>Reading | ################################################## | 100% 3.90s</p>
<p>avrdude: verifying ... avrdude: 3338 bytes of flash verified avrdude: reading input file "device/try1/eprom.hex" avrdude: writing eeprom (26 bytes):</p>
<p>Writing | ################################################## | 100% 1.55s</p>
<p>avrdude: 26 bytes of eeprom written avrdude: verifying eeprom memory against device/try1/eprom.hex: avrdude: load data eeprom data from input file device/try1/eprom.hex: avrdude: input file device/try1/eprom.hex contains 26 bytes avrdude: reading on-chip eeprom data:</p>
<p>Reading | ################################################## | 100% 0.29s</p>
<p>avrdude: verifying ... avrdude: 26 bytes of eeprom verified avrdude: reading input file "0xE2" avrdude: writing lfuse (1 bytes):</p>
<p>Writing | ################################################## | 100% 0.02s</p>
<p>avrdude: 1 bytes of lfuse written avrdude: verifying lfuse memory against 0xE2: avrdude: load data lfuse data from input file 0xE2: avrdude: input file 0xE2 contains 1 bytes avrdude: reading on-chip lfuse data:</p>
<p>Reading | ################################################## | 100% 0.02s</p>
<p>avrdude: verifying ... avrdude: 1 bytes of lfuse verified avrdude: reading input file "0xDC" avrdude: writing hfuse (1 bytes):</p>
<p>Writing | ################################################## | 100% 0.02s</p>
<p>avrdude: 1 bytes of hfuse written avrdude: verifying hfuse memory against 0xDC: avrdude: load data hfuse data from input file 0xDC: avrdude: input file 0xDC contains 1 bytes avrdude: reading on-chip hfuse data:</p>
<p>Reading | ################################################## | 100% 0.02s</p>
<p>avrdude: verifying ... avrdude: 1 bytes of hfuse verified</p>
<p>avrdude done. Thank you.</p>
<p>make[1]: Leaving directory `/home/osboxes/sketchbook/cli/owslave' osboxes:~/sketchbook/cli/owslave$</p>
<p>BINGO! It works! :))</p>
<p>test now... (<a href="https://github.com/M-o-a-T/owslave/blob/master/HOWTO.md">https://github.com/M-o-a-T/owslave/blob/master/HOWTO.md</a>) onewire_io Choose which pin to connect your 1wire bus to. For now, only pins with dedicated interrupts (INTx) can be used. On an ATmega168, these are pins D2 and D3. The default is INT0. <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/8006S.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/8006S.pdf</a> INT0 -&gt; Pin 5 PCINT0 -&gt; Pin 13 VCC -&gt; Pin 1 GND -&gt; Pin 14</p>
<p>DOES NOT WORK ON THE BUS - MAY BE DUE TO THE FACT THAT 't84' IS NOT RECOGNIZED AND IT COMPILES AS 'm88'.</p>
<p>See also: <a href="https://electronics.stackexchange.com/questions/205055/using-avrdude-to-program-attiny-via-arduino-as-isp">https://electronics.stackexchange.com/questions/205055/using-avrdude-to-program-attiny-via-arduino-as-isp</a> <a href="https://forum.arduino.cc/index.php?topic=349912.0">https://forum.arduino.cc/index.php?topic=349912.0</a></p>
<p>&mdash; Issues &mdash;</p>
<p>In project.cfg "defaults.target.t85" is recognized as attiny85 but does NOT compile.</p>
<p>In project.cfg "defaults.target.t84" is NOT recognized as attiny84 but does compile as m88 (atmega88).</p>
<p>&mdash; using ATmega88 (mega88) &mdash;</p>
<p><a href="https://www.avrprogrammers.com/articles/atmega8-vs-atmega328">https://www.avrprogrammers.com/articles/atmega8-vs-atmega328</a></p>
<p>-&mdash; programmer -&mdash;</p>
<p>Use Arduino Uno and my "Programmer Shield".</p>
<p>Open Arduino IDE (e.g. 1.6.5) and open File &gt; Examples &gt; ArdinoISP</p>
<p>Upload the sketch to an Arduino Uno board.</p>
<p>Adopt "Programmer Shield" to be wired for a mega88, see sketch and: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-2545-8-bit-AVR-Microcontroller-ATmega48-88-168_Summary.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-2545-8-bit-AVR-Microcontroller-ATmega48-88-168_Summary.pdf</a></p>
<ul>
<li>Arduino 5V an ATmega88 Pin 7 (VCC +) und ATmega88 Pin 20 AVCC</li>
<li>Arduino GND an ATmega88 Pin 8 (GND -)</li>
<li>Arduino Pin 10 an ATmega88 Pin 1 PC6 (PCINT14/RESET)</li>
<li>Arduino Pin 11 an ATmega88 Pin 17 PB3 (MOSI/OC2A/PCINT3)</li>
<li>Arduino Pin 12 an ATmega88 Pin 18 PB4 (MISO/PCINT4)</li>
<li>Arduino Pin 13 an ATmega88 Pin 19 PB5 (SCK/PCINT5)</li>
</ul>
<p>-&mdash; chip -&mdash;</p>
<p>create or add you project.cfg (project.cfg.mega88) to the folder</p>
<p>osboxes:~/sketchbook/cli/owslave$ nano Makefile</p>
<p>change the line  -c  -p  -C +$$TF\ into  -c  -p  -b 19200 -P /dev/ttyACM0 -C +$$TF\ save and quit</p>
<p>( osboxes:~/sketchbook/cli/owslave$ chmod +x cfg <a class="el" href="Cfg_8py.html">Cfg.py</a> cfg_write gen_eeprom <a class="el" href="ordered__yaml_8py.html">ordered_yaml.py</a> )</p>
<p>osboxes:~/sketchbook/cli/owslave$ make CFG=project.cfg try1 make[1]: Entering directory `/home/osboxes/sketchbook/cli/owslave' mkdir -p device/try1 MCU:atmega88 MCU_PROG:m88 PROG:avrisp AVRDUDE:sudo avrdude CFILES:<a class="el" href="moat__backend_8c.html">moat_backend.c</a> main.c jmp.S <a class="el" href="dev__data_8c.html">dev_data.c</a> config.o <a class="el" href="timer_8c.html">timer.c</a> <a class="el" href="ds2423_8c.html">ds2423.c</a> <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="crc_8c.html">crc.c</a> TYPE:port 0 temp 0 pwm 0 alert -1 adc 0 console 0 pid 0 config -1 humid 0 count 0 smoke 0 mkdir -p device/try1 ./cfg project.cfg .hdr try1 avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/moat_backend.o <a class="el" href="moat__backend_8c.html">moat_backend.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/main.o main.c main.c:120:17: warning: ‘bootseq’ defined but not used [-Wunused-variable] static uint16_t bootseq <b>attribute</b>((section(".noinit"))); ^ avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/jmp.o jmp.S avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/dev_data.o <a class="el" href="dev__data_8c.html">dev_data.c</a> set -e; \ ./gen_eeprom device/try1/eprom.bin type $(./cfg project.cfg .type try1); \ if ./gen_eeprom device/try1/eprom.bin name &gt;/dev/null 2&gt;&amp;1 ; then : ; else \ ./gen_eeprom device/try1/eprom.bin name try1 ; fi ; \ if [ ds2423 != 0 ] ; then \ if ./gen_eeprom device/try1/eprom.bin owid serial &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./gen_eeprom device/try1/eprom.bin owid serial); \ if ./cfg project.cfg devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ test "$(./cfg project.cfg devices.try1.onewire_id)" = "$SER" ; \ else \ ./cfg_write project.cfg devices.try1.onewire_id x$SER; \ fi; \ elif ./cfg project.cfg .nofollow devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./cfg project.cfg devices.try1.onewire_id); \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial $SER; \ else \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial random; \ ./cfg_write project.cfg devices.try1.onewire_id x$(./gen_eeprom device/try1/eprom.bin owid serial); \ fi; \ fi avr-objcopy -I binary -O elf32-avr &ndash;prefix-sections=.eeprom \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_start=_econfig_start" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_size=_econfig_size" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_end=_econfig_end" \ device/try1/eprom.bin device/try1/config.o avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/timer.o <a class="el" href="timer_8c.html">timer.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/ds2423.o <a class="el" href="ds2423_8c.html">ds2423.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/onewire.o <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="onewire_8c.html">onewire.c</a>:553:2: warning: #warning "Ignore the 'appears to be a misspelled signal handler' warning" [-Wcpp] #warning "Ignore the 'appears to be a misspelled signal handler' warning" ^ <a class="el" href="onewire_8c.html">onewire.c</a>: In function ‘real_PIN_INT’: <a class="el" href="onewire_8c.html">onewire.c</a>:554:6: warning: ‘real_PIN_INT’ appears to be a misspelled signal handler [enabled by default] void <a class="el" href="onewire_8c.html#ad685ebd23c8e96348e9924394dc696a8">real_PIN_INT(void)</a> { ^ avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -c -o device/try1/crc.o <a class="el" href="crc_8c.html">crc.c</a> avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -o device/try1/image.elf -Wl,-Map,device/try1/image.map,&ndash;cref device/try1/moat_backend.o device/try1/main.o device/try1/jmp.o device/try1/dev_data.o device/try1/config.o device/try1/timer.o device/try1/ds2423.o device/try1/onewire.o device/try1/crc.o avr-objcopy -R .eeprom -O ihex device/try1/image.elf device/try1/image.hex avr-objcopy -j .eeprom &ndash;change-section-address .eeprom=0 -O ihex device/try1/image.elf device/try1/eprom.hex avr-objdump -h -S device/try1/image.elf &gt; device/try1/image.lss make[1]: Leaving directory `/home/osboxes/sketchbook/cli/owslave'</p>
<p>Press RESET button on "Programmer Shield" if LED (Pin 8) is on (should be off).</p>
<p>osboxes:~/sketchbook/cli/owslave$ make CFG=project.cfg burn_try1 BURN try1 make[1]: Entering directory `/home/osboxes/sketchbook/cli/owslave' LFUSE:E2 HFUSE:DC EFUSE:00 EEPROM:1 MCU:atmega88 MCU_PROG:m88 PROG:avrisp AVRDUDE:sudo avrdude CFILES:<a class="el" href="moat__backend_8c.html">moat_backend.c</a> main.c jmp.S <a class="el" href="dev__data_8c.html">dev_data.c</a> config.o <a class="el" href="timer_8c.html">timer.c</a> <a class="el" href="ds2423_8c.html">ds2423.c</a> <a class="el" href="onewire_8c.html">onewire.c</a> <a class="el" href="crc_8c.html">crc.c</a> TYPE:smoke 0 humid 0 temp 0 pwm 0 adc 0 port 0 config -1 alert -1 console 0 count 0 pid 0 set -e; \ ./gen_eeprom device/try1/eprom.bin type $(./cfg project.cfg .type try1); \ if ./gen_eeprom device/try1/eprom.bin name &gt;/dev/null 2&gt;&amp;1 ; then : ; else \ ./gen_eeprom device/try1/eprom.bin name try1 ; fi ; \ if [ ds2423 != 0 ] ; then \ if ./gen_eeprom device/try1/eprom.bin owid serial &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./gen_eeprom device/try1/eprom.bin owid serial); \ if ./cfg project.cfg devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ test "$(./cfg project.cfg devices.try1.onewire_id)" = "$SER" ; \ else \ ./cfg_write project.cfg devices.try1.onewire_id x$SER; \ fi; \ elif ./cfg project.cfg .nofollow devices.try1.onewire_id &gt;/dev/null 2&gt;&amp;1 ; then \ SER=$(./cfg project.cfg devices.try1.onewire_id); \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial $SER; \ else \ ./gen_eeprom device/try1/eprom.bin owid type 0x$(./cfg project.cfg codes.onewire.ds2423) serial random; \ ./cfg_write project.cfg devices.try1.onewire_id x$(./gen_eeprom device/try1/eprom.bin owid serial); \ fi; \ fi avr-objcopy -I binary -O elf32-avr &ndash;prefix-sections=.eeprom \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_start=_econfig_start" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_size=_econfig_size" \ &ndash;redefine-sym "_binary_device_try1_eprom_bin_end=_econfig_end" \ device/try1/eprom.bin device/try1/config.o avr-gcc -g -mmcu=atmega88 -Wall -Wstrict-prototypes -Os -mcall-prologues -fshort-enums -Idevice/try1 -o device/try1/image.elf -Wl,-Map,device/try1/image.map,&ndash;cref device/try1/moat_backend.o device/try1/main.o device/try1/jmp.o device/try1/dev_data.o device/try1/config.o device/try1/timer.o device/try1/ds2423.o device/try1/onewire.o device/try1/crc.o avr-objcopy -R .eeprom -O ihex device/try1/image.elf device/try1/image.hex avr-objcopy -j .eeprom &ndash;change-section-address .eeprom=0 -O ihex device/try1/image.elf device/try1/eprom.hex avr-objdump -h -S device/try1/image.elf &gt; device/try1/image.lss TF=$(mktemp avrdude-cfg.XXXXX); echo "default_safemode = no;" &gt;$TF; \ EFUSE=00; \ [ "" != "" ] &amp;&amp; SET_EFUSE="-U efuse:w:0x00:m"; \ sudo avrdude -c avrisp -p m88 -b 19200 -P /dev/ttyACM0 -C +$TF\ -U flash:w:device/try1/image.hex:i -U eeprom:w:device/try1/eprom.hex:i \ -U lfuse:w:0xE2:m \ -U hfuse:w:0xDC:m \ \ ; X=$?; rm $TF; exit $X [sudo] password for osboxes:</p>
<p>avrdude: AVR device initialized and ready to accept instructions</p>
<p>Reading | ################################################## | 100% 0.02s</p>
<p>avrdude: Device signature = 0x1e930a avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed To disable this feature, specify the -D option. avrdude: erasing chip avrdude: reading input file "device/try1/image.hex" avrdude: writing flash (3338 bytes):</p>
<p>Writing | ################################################## | 100% 4.99s</p>
<p>avrdude: 3338 bytes of flash written avrdude: verifying flash memory against device/try1/image.hex: avrdude: load data flash data from input file device/try1/image.hex: avrdude: input file device/try1/image.hex contains 3338 bytes avrdude: reading on-chip flash data:</p>
<p>Reading | ################################################## | 100% 2.60s</p>
<p>avrdude: verifying ... avrdude: 3338 bytes of flash verified avrdude: reading input file "device/try1/eprom.hex" avrdude: writing eeprom (26 bytes):</p>
<p>Writing | ################################################## | 100% 1.37s</p>
<p>avrdude: 26 bytes of eeprom written avrdude: verifying eeprom memory against device/try1/eprom.hex: avrdude: load data eeprom data from input file device/try1/eprom.hex: avrdude: input file device/try1/eprom.hex contains 26 bytes avrdude: reading on-chip eeprom data:</p>
<p>Reading | ################################################## | 100% 0.11s</p>
<p>avrdude: verifying ... avrdude: 26 bytes of eeprom verified avrdude: reading input file "0xE2" avrdude: writing lfuse (1 bytes):</p>
<p>Writing | ################################################## | 100% 0.02s</p>
<p>avrdude: 1 bytes of lfuse written avrdude: verifying lfuse memory against 0xE2: avrdude: load data lfuse data from input file 0xE2: avrdude: input file 0xE2 contains 1 bytes avrdude: reading on-chip lfuse data:</p>
<p>Reading | ################################################## | 100% 0.01s</p>
<p>avrdude: verifying ... avrdude: 1 bytes of lfuse verified avrdude: reading input file "0xDC" avrdude: writing hfuse (1 bytes):</p>
<p>Writing | ################################################## | 100% 0.02s</p>
<p>avrdude: 1 bytes of hfuse written avrdude: verifying hfuse memory against 0xDC: avrdude: load data hfuse data from input file 0xDC: avrdude: input file 0xDC contains 1 bytes avrdude: reading on-chip hfuse data:</p>
<p>Reading | ################################################## | 100% 0.01s</p>
<p>avrdude: verifying ... avrdude: 1 bytes of hfuse verified</p>
<p>avrdude done. Thank you.</p>
<p>make[1]: Leaving directory `/home/osboxes/sketchbook/cli/owslave' osboxes:~/sketchbook/cli/owslave$</p>
<p>Test the device by connecting it to a 1-wire bus and check for the presence of a new DS2423.</p>
<p>(<a href="https://github.com/M-o-a-T/owslave/blob/master/HOWTO.md">https://github.com/M-o-a-T/owslave/blob/master/HOWTO.md</a>) onewire_io Choose which pin to connect your 1wire bus to. For now, only pins with dedicated interrupts (INTx) can be used. On an ATmega168, these are pins D2 and D3. The default is INT0.</p>
<ul>
<li>DATA to ATmega88 Pin 4 PD2 (PCINT18/INT0)</li>
<li>5V to ATmega88 Pin 7 (VCC +)</li>
<li>GND to ATmega88 Pin 8 (GND -)</li>
<li>5V to ATmega88 Pin 20 AVCC</li>
<li>IN_A to ATmega88 Pin 23 PC0 (ADC0/PCINT8)</li>
<li>IN_B to ATmega88 Pin 24 PC1 (ADC1/PCINT9)</li>
</ul>
<p>BINGO! It works! :))</p>
<p>&mdash; using Tiny (not working yet) &mdash;</p>
<p>Issues with ATtiny85: <a href="https://github.com/M-o-a-T/owslave/issues/16">https://github.com/M-o-a-T/owslave/issues/16</a> Support for ATtiny84: <a href="https://github.com/M-o-a-T/owslave/issues/17">https://github.com/M-o-a-T/owslave/issues/17</a></p>
<p>&mdash; using Arduino Uno or Nano Board (not recommened) &mdash;</p>
<p>You need to bypass the bootloader and program the raw/whole chip by connecting another Arduino Board to the ISP header of the first (the one to be programmed). See <a href="https://www.arduino.cc/en/Tutorial/ArduinoISP">https://www.arduino.cc/en/Tutorial/ArduinoISP</a></p>
<p>During this process the bootloader get bypassed and overwritten, so to use the Board as usual again you have to load the bootloader by ISP header again.</p>
<p>You should also check first whether the pins wirde on the Board are the ones you need and that they are wired properly.</p>
<p>The Makefile should then may be contain something like:  -c arduino -p atmega328p -b 57600 -P /dev/ttyUSB0 -C +$$TF\ </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 24 2019 21:30:39 for sketchbook by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
